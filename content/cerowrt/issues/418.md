---
title: "Bug #418: TFO crashes cerowrt 3.7.1-1"
subject: "TFO crashes cerowrt 3.7.1-1"
date: 2013-01-04T19:02:14
updated: 2014-05-14T11:35:21
type: issue
author: David Taht
id: 418
issue_status: Closed
priority: Normal
assignee: Dave Täht
aliases:
    - /issues/418
---

{{< issue_description >}}
I am not able to get through even a single TCP TFO connection. The
router restarts as soon as it sees the TFO connection.

Looks like SYN+Data is crashing the box (see attached trace captured on
lo iface of cero). logread, dmesg did not show anything. I don't know
whether its kernel panic.

This is strange as 3.6 was working for SYN+Data cases.

However the difference from previous instance is the polipo server with
TFO running on cero box. Client may run on same cero or on my laptop
which in either case crashes the box.

On 3.7, if I run the TFO client on cero box and TFO server on the
laptop, it still works but not the reverse.

(see email thread at:
https://lists.bufferbloat.net/pipermail/cerowrt-devel/2013-January/000844.html
for more details)

### Attachments
{{< attachment name="lo_capture.txt" type="text/plain" size="1.9 kiB" description="" filename="130104190215_lo_capture.txt" date="2013-01-04T19:02:15" author="David Taht" >}}
{{< attachment name="tfo_to_x86_64_web.cap" type="application/vnd.tcpdump.pcap" size="206.6 kiB" description="httping -G -F http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg" filename="130104192134_tfo_to_x86_64_web.cap" date="2013-01-04T19:21:34" author="David Taht" >}}
{{< attachment name="tfo_to_x86_64_web_via_proxy.cap" type="application/vnd.tcpdump.pcap" size="153.4 kiB" description="httping -x 172.26.3.4:8123 -G -F http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg" filename="130104192134_tfo_to_x86_64_web_via_proxy.cap" date="2013-01-04T19:21:34" author="David Taht" >}}
{{< attachment name="tfo_to_x86_64_web_via_proxy_tfo_enabled.cap" type="application/vnd.tcpdump.pcap" size="133.3 kiB" description="httping -x 172.26.3.4:8123 -G -F http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg" filename="130104192134_tfo_to_x86_64_web_via_proxy_tfo_enabled.cap" date="2013-01-04T19:21:34" author="David Taht" >}}
{{< attachment name="vyatta-fq_codel_bql32k.svg.gz" type="application/x-gzip" size="39.9 kiB" description="" filename="130104192134_vyatta-fq_codel_bql32k.svg.gz" date="2013-01-04T19:21:34" author="David Taht" >}}
{{< attachment name="tfo_to_x86_64_web_via_proxy_tfo_enabled_nomiddleboxrules.cap" type="application/vnd.tcpdump.pcap" size="122.7 kiB" description="" filename="130104200303_tfo_to_x86_64_web_via_proxy_tfo_enabled_nomiddleboxrules.cap" date="2013-01-04T20:03:03" author="David Taht" >}}
{{< attachment name="tfo_crash_fixed.patch" type="text/x-patch" size="533 bytes" description="This patch by Eric D should fix the crash" filename="130114012656_tfo_crash_fixed.patch" date="2013-01-14T01:26:56" author="Ketan Kulkarni" >}}

{{< /issue_description >}}

## History
{{< issue_journal date="2013-01-04T19:06:30" author="David Taht" >}}
I had been building up a 3.7.1-X based testbed anyway, which looks (in
part) like this:

    3.6.8 laptop (presently) with iwl wifi driver

    traceroute to 172.26.3.4 (172.26.3.4), 30 hops max, 60 byte packets
     1  172.26.2.1  2.978 ms  2.890 ms  10.955 ms   picostation 2HP (wireless)
     2  172.26.1.4  10.934 ms  10.903 ms  10.868 ms nanostation m5 (wired)
     3  172.26.1.1  13.826 ms  13.802 ms  13.785 ms nanostation m5 (wired)
     4  172.26.3.224  16.374 ms  16.366 ms  16.361 ms cerowrt 3.7.1-1 adhoc mesh
     5  172.26.3.4  16.355 ms  16.327 ms  16.296 ms x86_64 box with 3.7.1-1 on it

so future tests will be against that for a while.
{{< /issue_journal >}}
{{< issue_journal date="2013-01-04T19:21:34" author="David Taht" >}}
In an effort to duplicate ketan's bug, I first setup a x86\_64 box as a
web and polipo (with tfo patch) server on the other side of the testbed.
And ran three tests, using httping to issue a full GET request (as
opposed to HEAD), once with tfo disabled, another time via polipo with
tfo off in polipo, and the last with it on.

The commands:

     httping -G -F http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg
     httping -x 172.26.3.4:8123 -G -F http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg
     httping -x 172.26.3.4:8123 -G -F http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg

The capture script (note you'd have to change this to port 80 for
proxyless and your own server ip)

    tcpdump -i wlan1 -w tfo_to_x86_64_web_via_proxy_tfo_enabled.cap port 8123 and host 172.26.3.4

Going 3.6.8 to 3.7.1 over x86\_64 over this network... worked! The
performance improvement of TFO on vs off over the proxy OVER this
multi-hope WIFI connection was remarkable:


    root@ida:~/src/httping-1.5.6# httping -x 172.26.3.4:8123 -G -Fw http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg
    Using proxyserver: 172.26.3.4:8123
    PING 172.26.3.4:80 (http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg):
    connected to 172.26.3.4:80 (273 bytes), seq=0 time=11.47 ms 
    connected to 172.26.3.4:80 (273 bytes), seq=1 time=12.82 ms 
    connected to 172.26.3.4:80 (273 bytes), seq=2 time=10.79 ms 
    connected to 172.26.3.4:80 (273 bytes), seq=3 time=9.92 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=4 time=10.76 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=5 time=12.01 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=6 time=13.64 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=7 time=11.10 ms 
    Got signal 2
    --- http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg ping statistics ---
    8 connects, 8 ok, 0.00% failed, time 7695ms
    round-trip min/avg/max = 9.9/11.6/13.6 ms

    root@ida:~/src/httping-1.5.6# httping -x 172.26.3.4:8123 -G -F http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg
    Using proxyserver: 172.26.3.4:8123
    PING 172.26.3.4:80 (http://172.26.3.4/~d/rrul/vyatta-fq_codel_bql32k.svg):
    connected to 172.26.3.4:80 (274 bytes), seq=0 time=9.69 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=1 time=5.57 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=2 time=10.11 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=3 time=8.11 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=4 time=6.61 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=5 time=5.71 ms 
    connected to 172.26.3.4:80 (274 bytes), seq=6 time=5.78 ms 

If this stuff can actually be made secure and deployable, it's going to
be a big win on web servers and proxies and a variety of other connect
time sensitive TCP based applications.

(I included the actual rrul file I was transferring for completeness,
which is showing this odd periodic spike in loss being incurred
somewhere on the path elsewhere.... and has nothing to do with the TFO
test...)
{{< /issue_journal >}}
{{< issue_journal date="2013-01-04T19:57:06" author="David Taht" >}}
Heh. Spoke too soon on the performance front. The packet capture shows
the 3.6.11 middlebox shipping a RST on the first big packet.... it
appears to have conntracking on but little else.


    root@closet:~# uname -a
    Linux closet.wifi.armory.com 3.6.11 #2 Mon Dec 24 05:24:18 PST 2012 mips GNU/Linux
    root@closet:~# iptables -L
    Chain INPUT (policy ACCEPT)
    target     prot opt source               destination         
    ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
    ACCEPT     all  --  anywhere             anywhere            
    input_rule  all  --  anywhere             anywhere            
    input      all  --  anywhere             anywhere            

    Chain FORWARD (policy ACCEPT)
    target     prot opt source               destination         
    ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
    forwarding_rule  all  --  anywhere             anywhere            
    forward    all  --  anywhere             anywhere            

    Chain OUTPUT (policy ACCEPT)
    target     prot opt source               destination         
    ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
    ACCEPT     all  --  anywhere             anywhere            
    output_rule  all  --  anywhere             anywhere            
    output     all  --  anywhere             anywhere            

    Chain forward (1 references)
    target     prot opt source               destination         

    Chain forwarding_rule (1 references)
    target     prot opt source               destination         

    Chain input (1 references)
    target     prot opt source               destination         

    Chain input_rule (1 references)
    target     prot opt source               destination         

    Chain output (1 references)
    target     prot opt source               destination         

    Chain output_rule (1 references)
    target     prot opt source               destination         

    Chain reject (0 references)
    target     prot opt source               destination         
    REJECT     tcp  --  anywhere             anywhere             reject-with tcp-reset
    REJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable

{{< /issue_journal >}}
{{< issue_journal date="2013-01-04T20:03:03" author="David Taht" >}}
flushed iptables rules, similar result, capture attached...

Need to simplify the test a bit, a few too many machines in the way
right now
{{< /issue_journal >}}
{{< issue_journal date="2013-01-05T10:31:06" author="Ketan Kulkarni" >}}
Dave, the RST you are getting is probably the behavior of httping.
By default httping accepts only 4096 bytes of data and after than it
simply closes the socket. (closing a socket when data is pending to read
will send the RST).\
Even I could see the same behavior when I tried -G (using GET for a
larger file) on localhost.

Try adding these options to your httping cmd if you are using -G\
-b -X -L 100000

~~L~~&gt; configures the size of the data that you want to receive after
which httping will just close the connection.\
-b to show transfer speed\
-X to show how much data was transferred in a single ping.
{{< /issue_journal >}}
{{< issue_journal date="2013-01-05T10:33:59" author="Ketan Kulkarni" >}}
BTW, I am just using the HEAD request by default which then\
automatically limits the response to a single packet.\
Don't you think this is better way to test the http latency than to\
completely download the file using GET?

Thanks,

On Sun, Jan 6, 2013 at 12:01 AM, <cerowrt@lists.bufferbloat.net> wrote:\
>\
> Issue \#418 has been updated by Ketan Kulkarni.\
>\
>\
> Dave, the RST you are getting is probably the behavior of httping.
> By default httping accepts only 4096 bytes of data and after than
it simply closes the socket. (closing a socket when data is pending to
read will send the RST).\
> Even I could see the same behavior when I tried -G (using GET for a
larger file) on localhost.\
>\
> Try adding these options to your httping cmd if you are using -G\
> -b -X -L 100000\
>\
> ~~L~~> configures the size of the data that you want to receive
after which httping will just close the connection.\
> -b to show transfer speed\
> -X to show how much data was transferred in a single ping.\
> ----------------------------------------\
> Bug \#418: TFO crashes cerowrt 3.7.1-1\
> https://www.bufferbloat.net/issues/418
>\
> Author: David Taht\
> Status: New\
> Priority: Normal\
> Assignee: Dave Täht\
> Category: Networking\
> Target version:\
>\
>\
> I am not able to get through even a single TCP TFO connection. The
router restarts as soon as it sees the TFO connection.\
>\
> Looks like SYN+Data is crashing the box (see attached trace
captured on lo iface of cero). logread, dmesg did not show anything. I
don't know whether its kernel panic.\
>\
> This is strange as 3.6 was working for SYN+Data cases.\
>\
> However the difference from previous instance is the polipo server
with TFO running on cero box. Client may run on same cero or on my
laptop which in either case crashes the box.\
>\
> On 3.7, if I run the TFO client on cero box and TFO server on the
laptop, it still works but not the reverse.\
>\
> (see email thread at:
https://lists.bufferbloat.net/pipermail/cerowrt-devel/2013-January/000844.html
for more details)\
>\
>
{{< /issue_journal >}}
{{< issue_journal date="2013-01-05T10:58:46" author="Ketan Kulkarni" >}}
Disabling ECN on cero and TFO ON has no effect.\
The crash is still seen on cero.

This is the trace I get (similar to lo\_capture.txt with ECN disabled)

root@OpenWrt:\~\# httping -F -g http://127.0.0.1:8123/
PING 127.0.0.1:8123 (http://127.0.0.1:8123/):
18:15:37.736001 IP localhost.39443 &gt; localhost.8123: Flags \[S\], seq
4217980186, win 43690, options \[mss 65495,sackOK,TS val 343024 ecr
0,nop,wscale 6,Unknown Option 254f989\], length 0\
18:15:37.736121 IP localhost.8123 &gt; localhost.39443: Flags \[S.\],
seq 1926633800, ack 4217980187, win 43690, options \[mss 65495,sackOK,TS
val 343024 ecr 343024,nop,wscale 6,Unknown Option
254f989df087214939732ef\], length 0\
18:15:37.736174 IP localhost.39443 &gt; localhost.8123: Flags \[.\], ack
1, win 683, options \[nop,nop,TS val 343024 ecr 343024\], length 0\
connected to 127.0.0.1:8123 (183 bytes), seq=0 time=3.21 ms\
18:15:37.737372 IP localhost.39443 &gt; localhost.8123: Flags \[P.\],
seq 1:65, ack 1, win 683, options \[nop,nop,TS val 343024 ecr 343024\],
length 64\
18:15:37.737538 IP localhost.8123 &gt; localhost.39443: Flags \[.\], ack
65, win 683, options \[nop,nop,TS val 343024 ecr 343024\], length 0\
18:15:37.738395 IP localhost.8123 &gt; localhost.39443: Flags \[P.\],
seq 1:184, ack 65, win 683, options \[nop,nop,TS val 343025 ecr
343024\], length 183\
18:15:37.738565 IP localhost.8123 &gt; localhost.39443: Flags \[F.\],
seq 184, ack 65, win 683, options \[nop,nop,TS val 343025 ecr 343024\],
length 0\
18:15:37.738682 IP localhost.39443 &gt; localhost.8123: Flags \[.\], ack
184, win 700, options \[nop,nop,TS val 343025 ecr 343025\], length 0\
18:15:37.738953 IP localhost.39443 &gt; localhost.8123: Flags \[F.\],
seq 65, ack 185, win 700, options \[nop,nop,TS val 343025 ecr 343025\],
length 0\
18:15:37.739063 IP localhost.8123 &gt; localhost.39443: Flags \[.\], ack
66, win 683, options \[nop,nop,TS val 343025 ecr 343025\], length 0
{{< /issue_journal >}}
{{< issue_journal date="2013-01-05T11:59:52" author="David Taht" >}}
On Sat, Jan 5, 2013 at 1:34 PM, <cerowrt@lists.bufferbloat.net> wrote:\
>\
> Issue \#418 has been updated by Ketan Kulkarni.\
>\
>\
> BTW, I am just using the HEAD request by default which then\
> automatically limits the response to a single packet.\
> Don't you think this is better way to test the http latency than
to\
> completely download the file using GET?

Depends on what you were testing for. ME, I was working on looking at\
wifi aggregate behavior over the mesh network and doing a GET to grab\
a file with 40K in it (less than one aggregate) seemed sane at the\
time.

Didn't know that httping cut off at 4k with the RST, so my test was\
invalid. Thank you for the modified version!

Am also glad it wasn't the middle box!

certainly if all we want to do is test the time of a tcp setup, a head\
request is saner.

>\
> Thanks,\
>\
> On Sun, Jan 6, 2013 at 12:01 AM, <cerowrt@lists.bufferbloat.net>
wrote:\
>>\
>> Issue \#418 has been updated by Ketan Kulkarni.\
>>\
>>\
>> Dave, the RST you are getting is probably the behavior of
httping.
>> By default httping accepts only 4096 bytes of data and after
than it simply closes the socket. (closing a socket when data is pending
to read will send the RST).\
>> Even I could see the same behavior when I tried -G (using GET
for a larger file) on localhost.\
>>\
>> Try adding these options to your httping cmd if you are using
-G\
>> -b -X -L 100000\
>>\
>> ~~L~~> configures the size of the data that you want to
receive after which httping will just close the connection.\
>> -b to show transfer speed\
>> -X to show how much data was transferred in a single ping.\
>> ----------------------------------------\
>> Bug \#418: TFO crashes cerowrt 3.7.1-1\
>> https://www.bufferbloat.net/issues/418
>>\
>> Author: David Taht\
>> Status: New\
>> Priority: Normal\
>> Assignee: Dave Täht\
>> Category: Networking\
>> Target version:\
>>\
>>\
>> I am not able to get through even a single TCP TFO connection.
The router restarts as soon as it sees the TFO connection.\
>>\
>> Looks like SYN+Data is crashing the box (see attached trace
captured on lo iface of cero). logread, dmesg did not show anything. I
don't know whether its kernel panic.\
>>\
>> This is strange as 3.6 was working for SYN+Data cases.\
>>\
>> However the difference from previous instance is the polipo
server with TFO running on cero box. Client may run on same cero or on
my laptop which in either case crashes the box.\
>>\
>> On 3.7, if I run the TFO client on cero box and TFO server on
the laptop, it still works but not the reverse.\
>>\
>> (see email thread at:
https://lists.bufferbloat.net/pipermail/cerowrt-devel/2013-January/000844.html
for more details)\
>>\
>>\
> ----------------------------------------\
> Bug \#418: TFO crashes cerowrt 3.7.1-1\
> https://www.bufferbloat.net/issues/418
>\
> Author: David Taht\
> Status: New\
> Priority: Normal\
> Assignee: Dave Täht\
> Category: Networking\
> Target version:\
>\
>\
> I am not able to get through even a single TCP TFO connection. The
router restarts as soon as it sees the TFO connection.\
>\
> Looks like SYN+Data is crashing the box (see attached trace
captured on lo iface of cero). logread, dmesg did not show anything. I
don't know whether its kernel panic.\
>\
> This is strange as 3.6 was working for SYN+Data cases.\
>\
> However the difference from previous instance is the polipo server
with TFO running on cero box. Client may run on same cero or on my
laptop which in either case crashes the box.\
>\
> On 3.7, if I run the TFO client on cero box and TFO server on the
laptop, it still works but not the reverse.\
>\
> (see email thread at:
https://lists.bufferbloat.net/pipermail/cerowrt-devel/2013-January/000844.html
for more details)\
>\
>
{{< /issue_journal >}}
{{< issue_journal date="2013-01-08T08:15:46" author="David Taht" >}}
While I acquired a serial adaptor for the 3800 I did not gain the time\
to look at this issue over the weekend.

I'm buried this week and may not be able to get to this til the weekend.
{{< /issue_journal >}}
{{< issue_journal date="2013-01-13T03:14:58" author="Ketan Kulkarni" >}}
I could get a chance to get the backtrace from serial port.\
I didnt do the kgdb session yet.

\[ 1024.530000\] Kernel bug detected\[\#1\]:\
\[ 1024.530000\] Cpu 0\
\[ 1024.530000\] \$ 0 : 00000000 00000000 00000001 00000014\
\[ 1024.530000\] \$ 4 : 8600a9a0 85446cc0 00000000 377f8397\
\[ 1024.530000\] \$ 8 : 00000000 00000000 00000000 204e7f80\
\[ 1024.530000\] \$12 : 39808080 00000007 00000000 00000000\
\[ 1024.530000\] \$16 : 85446cc0 854fb280 8600a500 00000000\
\[ 1024.530000\] \$20 : 85446cc0 80340000 00000006 803aac70\
\[ 1024.530000\] \$24 : 00000000 c0aa90d8\
\[ 1024.530000\] \$28 : 854c2000 854c3ad8 8033c050 8024a36c\
\[ 1024.530000\] Hi : 00000000\
\[ 1024.530000\] Lo : 00000000\
\[ 1024.530000\] epc : 801fc7f4 reqsk\_fastopen\_remove+0x30/0x17c\
\[ 1024.530000\] Tainted: G O\
\[ 1024.530000\] ra : 8024a36c tcp\_rcv\_state\_process+0x7b4/0xc28\
\[ 1024.530000\] Status: 1000fc03 KERNEL EXL IE\
\[ 1024.530000\] Cause : 10800034\
\[ 1024.530000\] PrId : 00019374 (MIPS 24Kc)\
\[ 1024.530000\] Modules linked in: sch\_teql sch\_tbf sch\_sfq
sch\_red\
sch\_qfq sch\_prio sch\_ns2\_codel sch\_nfq\_codel sch\_netem sch\_htb\
sch\_gred sch\_efq\_codel sch\_dsmark em\_text em\_nbyte em\_meta
em\_cmp\
cls\_basic act\_police act\_ipt act\_connmark act\_skbedit act\_mirred\
em\_u32 cls\_u32 cls\_tcindex cls\_flow cls\_route cls\_fw sch\_hfsc\
sch\_fq\_codel sch\_codel sch\_ingress ath79\_wdt xt\_hashlimit
xt\_set(O)\
ip\_set\_list\_set(O) ip\_set\_hash\_netport(O)
ip\_set\_hash\_netiface(O)\
ip\_set\_hash\_net(O) ip\_set\_hash\_ipportnet(O)
ip\_set\_hash\_ipportip(O)\
ip\_set\_hash\_ipport(O) ip\_set\_hash\_ip(O) ip\_set\_bitmap\_port(O)\
ip\_set\_bitmap\_ipmac(O) ip\_set\_bitmap\_ip(O) ip\_set(O)
ip6t\_REJECT\
ip6t\_rt ip6t\_hbh ip6t\_mh ip6t\_ipv6header ip6t\_frag ip6t\_eui64
ip6t\_ah\
ip6table\_raw ip6table\_mangle ip6table\_filter ip6\_tables\
nf\_conntrack\_ipv6 nf\_defrag\_ipv6 nfnetlink nf\_nat\_irc
nf\_nat\_ftp\
nf\_conntrack\_irc nf\_conntrack\_ftp xt\_policy xt\_esp ipt\_ah xt\_HL
xt\_hl\
xt\_ecn ipt\_ECN xt\_CLASSIFY xt\_time xt\_tcpmss xt\_statistic
xt\_mark\
xt\_length xt\_DSCP xt\_dscp xt\_string xt\_layer7 xt\_quota
xt\_pkttype\
xt\_physdev xt\_owner ipt\_MASQUERADE iptable\_nat xt\_nat
nf\_nat\_ipv4\
nf\_nat xt\_recent xt\_helper xt\_connmark xt\_connbytes pptp pppoe\
xt\_conntrack xt\_CT iptable\_raw xt\_state nf\_conntrack\_ipv4\
nf\_defrag\_ipv4 nf\_conntrack pppox ipt\_REJECT xt\_TCPMSS xt\_LOG\
xt\_comment xt\_multiport xt\_mac xt\_limit iptable\_mangle
iptable\_filter\
ip\_tables xt\_tcpudp x\_tables ip\_gre gre ifb sit xfrm4\_tunnel\
xfrm4\_mode\_tunnel xfrm4\_mode\_transport xfrm4\_mode\_beet esp4 ah4\
tunnel4 tun tcp\_ledbat(O) ppp\_async ppp\_generic slhc xfrm\_user\
xfrm\_algo vfat fat autofs4 button\_hotplug(O) ath9k(O)
ath9k\_common(O)\
ath9k\_hw(O) ath(O) nls\_utf8 nls\_iso8859\_2 nls\_iso8859\_15\
nls\_iso8859\_13 nls\_iso8859\_1 nls\_cp437 mac80211(O) ts\_fsm ts\_bm
ts\_kmp\
crc\_ccitt ipv6 input\_polldev cfg80211(O) compat(O) input\_core\
sha1\_generic md5 hmac des\_generic deflate cbc authenc arc4
usb\_storage\
ohci\_hcd ehci\_hcd sd\_mod ext4 jbd2 mbcache usbcore usb\_common
scsi\_mod\
nls\_base crc16 zlib\_inflate zlib\_deflate ledtrig\_timer\
ledtrig\_default\_on leds\_gpio gpio\_button\_hotplug(O)\
\[ 1024.530000\] Process seq (pid: 4023, threadinfo=854c2000,\
task=85461df8, tls=7735b440)\
\[ 1024.530000\] Stack : 00000000 8600a9a0 87287d80 8607bb58 85446cc0\
80330000 8600a9a0 87287d80\
8607bb58 8024a36c c0aa9720 c2337090 86b39000 00000000 00000001 00000014\
00000001 02000004 862b6d24 c2337000 00000001 8547bf00 00000000 00000000\
854c3bcc 854c3bcc 87287d80 854c3bcc 87287d80 80325dd8 87287d80 8600a9a0\
8600a9a0 8607bb58 8607bb44 802516ec 87287d80 803261dc 80340000 80340000\
...\
\[ 1024.530000\] Call Trace:\
\[ 1024.530000\] \[&lt;801fc7f4&gt;\]
reqsk\_fastopen\_remove+0x30/0x17c\
\[ 1024.530000\] \[&lt;8024a36c&gt;\]
tcp\_rcv\_state\_process+0x7b4/0xc28\
\[ 1024.530000\] \[&lt;802516ec&gt;\] tcp\_v4\_do\_rcv+0x21c/0x274\
\[ 1024.530000\] \[&lt;80253c74&gt;\] tcp\_v4\_rcv+0x5b4/0x974\
\[ 1024.530000\] \[&lt;802320f0&gt;\]
ip\_local\_deliver\_finish+0x168/0x29c\
\[ 1024.530000\] \[&lt;80207100&gt;\]
\_\_netif\_receive\_skb+0x63c/0x6c0\
\[ 1024.530000\] \[<c060b2e8>\] ieee80211\_deliver\_skb+0x1b8/0x220
\[mac80211\]\
\[ 1024.530000\] \[<c060cc70>\]\
ieee80211\_rx\_handlers.part.12+0x1654/0x23e0 \[mac80211\]\
\[ 1024.530000\] \[<c060e468>\]\
ieee80211\_prepare\_and\_rx\_handle+0xa6c/0xaf0 \[mac80211\]\
\[ 1024.530000\] \[<c060ecfc>\] ieee80211\_rx+0x810/0x8d8 \[mac80211\]\
\[ 1024.530000\] \[<c078651c>\] ath\_rx\_tasklet+0xf4c/0x10a4 \[ath9k\]\
\[ 1024.530000\] \[<c078437c>\] ath9k\_tasklet+0x104/0x174 \[ath9k\]\
\[ 1024.530000\] \[&lt;800793b8&gt;\] tasklet\_action+0x78/0xc8\
\[ 1024.530000\] \[&lt;80078c08&gt;\] \_\_do\_softirq+0xb0/0x184\
\[ 1024.530000\] \[&lt;80078d8c&gt;\] do\_softirq+0x48/0x68\
\[ 1024.530000\] \[&lt;80078fa8&gt;\] irq\_exit+0x4c/0x7c\
\[ 1024.530000\] \[&lt;8006330c&gt;\] ret\_from\_irq+0x0/0x4\
\[ 1024.530000\]\
\[ 1024.530000\]\
Code: 8e510208 30d300ff 2c420001 &lt;00028036&gt; 0c01e2a7 ac80048c\
8e220008 2442ffff ae220008\
\[ 1024.940000\] --~~\[ end trace a47ff22dd20a96c1 \]--~~\
\[ 1024.950000\] Kernel panic - not syncing: Fatal exception in
interrupt\
\[ 1024.950000\] -----------~~\[ cut here \]-----------~~\
\[ 1024.950000\] WARNING: at lib/vsprintf.c:1376 vsnprintf+0x6c/0x39c()\
\[ 1024.950000\] Modules linked in: sch\_teql sch\_tbf sch\_sfq
sch\_red\
sch\_qfq sch\_prio sch\_ns2\_codel sch\_nfq\_codel sch\_netem sch\_htb\
sch\_gred sch\_efq\_codel sch\_dsmark em\_text em\_nbyte em\_meta
em\_cmp\
cls\_basic act\_police act\_ipt act\_connmark act\_skbedit act\_mirred\
em\_u32 cls\_u32 cls\_tcindex cls\_flow cls\_route cls\_fw sch\_hfsc\
sch\_fq\_codel sch\_codel sch\_ingress ath79\_wdt xt\_hashlimit
xt\_set(O)\
ip\_set\_list\_set(O) ip\_set\_hash\_netport(O)
ip\_set\_hash\_netiface(O)\
ip\_set\_hash\_net(O) ip\_set\_hash\_ipportnet(O)
ip\_set\_hash\_ipportip(O)\
ip\_set\_hash\_ipport(O) ip\_set\_hash\_ip(O) ip\_set\_bitmap\_port(O)\
ip\_set\_bitmap\_ipmac(O) ip\_set\_bitmap\_ip(O) ip\_set(O)
ip6t\_REJECT\
ip6t\_rt ip6t\_hbh ip6t\_mh ip6t\_ipv6header ip6t\_frag ip6t\_eui64
ip6t\_ah\
ip6table\_raw ip6table\_mangle ip6table\_filter ip6\_tables\
nf\_conntrack\_ipv6 nf\_defrag\_ipv6 nfnetlink nf\_nat\_irc
nf\_nat\_ftp\
nf\_conntrack\_irc nf\_conntrack\_ftp xt\_policy xt\_esp ipt\_ah xt\_HL
xt\_hl\
xt\_ecn ipt\_ECN xt\_CLASSIFY xt\_time xt\_tcpmss xt\_statistic
xt\_mark\
xt\_length xt\_DSCP xt\_dscp xt\_string xt\_layer7 xt\_quota
xt\_pkttype\
xt\_physdev xt\_owner ipt\_MASQUERADE iptable\_nat xt\_nat
nf\_nat\_ipv4\
nf\_nat xt\_recent xt\_helper xt\_connmark xt\_connbytes pptp pppoe\
xt\_conntrack xt\_CT iptable\_raw xt\_state nf\_conntrack\_ipv4\
nf\_defrag\_ipv4 nf\_conntrack pppox ipt\_REJECT xt\_TCPMSS xt\_LOG\
xt\_comment xt\_multiport xt\_mac xt\_limit iptable\_mangle
iptable\_filter\
ip\_tables xt\_tcpudp x\_tables ip\_gre gre ifb sit xfrm4\_tunnel\
xfrm4\_mode\_tunnel xfrm4\_mode\_transport xfrm4\_mode\_beet esp4 ah4\
tunnel4 tun tcp\_ledbat(O) ppp\_async ppp\_generic slhc xfrm\_user\
xfrm\_algo vfat fat autofs4 button\_hotplug(O) ath9k(O)
ath9k\_common(O)\
ath9k\_hw(O) ath(O) nls\_utf8 nls\_iso8859\_2 nls\_iso8859\_15\
nls\_iso8859\_13 nls\_iso8859\_1 nls\_cp437 mac80211(O) ts\_fsm ts\_bm
ts\_kmp\
crc\_ccitt ipv6 input\_polldev cfg80211(O) compat(O) input\_core\
sha1\_generic md5 hmac des\_generic deflate cbc authenc arc4
usb\_storage\
ohci\_hcd ehci\_hcd sd\_mod ext4 jbd2 mbcache usbcore usb\_common
scsi\_mod\
nls\_base crc16 zlib\_inflate zlib\_deflate ledtrig\_timer\
ledtrig\_default\_on leds\_gpio gpio\_button\_hotplug(O)\
\[ 1024.950000\] Call Trace:\
\[ 1024.950000\] \[&lt;802a25e8&gt;\] dump\_stack+0x8/0x34\
\[ 1024.950000\] \[&lt;80071f84&gt;\] warn\_slowpath\_common+0x78/0xa4\
\[ 1024.950000\] \[&lt;80071fc8&gt;\] warn\_slowpath\_null+0x18/0x24\
\[ 1024.950000\] \[&lt;80183d5c&gt;\] vsnprintf+0x6c/0x39c\
\[ 1024.950000\] \[&lt;800bc99c&gt;\] crashlog\_printf+0x4c/0x68\
\[ 1024.950000\] \[&lt;800bca0c&gt;\] crashlog\_do\_dump+0x54/0x138\
\[ 1024.950000\] \[&lt;800752bc&gt;\] kmsg\_dump+0xe0/0x11c\
\[ 1024.950000\] \[&lt;802a26b4&gt;\] panic+0x8c/0x1b4\
\[ 1024.950000\] \[&lt;80067b68&gt;\] die+0x104/0x10c\
\[ 1024.950000\] \[&lt;80067cd0&gt;\] do\_trap\_or\_bp+0x118/0x18c\
\[ 1024.950000\] \[&lt;80063300&gt;\] ret\_from\_exception+0x0/0xc\
\[ 1024.950000\] \[&lt;801fc7f4&gt;\]
reqsk\_fastopen\_remove+0x30/0x17c\
\[ 1024.950000\] \[&lt;8024a36c&gt;\]
tcp\_rcv\_state\_process+0x7b4/0xc28\
\[ 1024.950000\] \[&lt;802516ec&gt;\] tcp\_v4\_do\_rcv+0x21c/0x274\
\[ 1024.950000\] \[&lt;80253c74&gt;\] tcp\_v4\_rcv+0x5b4/0x974\
\[ 1024.950000\] \[&lt;802320f0&gt;\]
ip\_local\_deliver\_finish+0x168/0x29c\
\[ 1024.950000\] \[&lt;80207100&gt;\]
\_\_netif\_receive\_skb+0x63c/0x6c0\
\[ 1024.950000\] \[<c060b2e8>\] ieee80211\_deliver\_skb+0x1b8/0x220
\[mac80211\]\
\[ 1024.950000\] \[<c060cc70>\]\
ieee80211\_rx\_handlers.part.12+0x1654/0x23e0 \[mac80211\]\
\[ 1024.950000\] \[<c060e468>\]\
ieee80211\_prepare\_and\_rx\_handle+0xa6c/0xaf0 \[mac80211\]\
\[ 1024.950000\] \[<c060ecfc>\] ieee80211\_rx+0x810/0x8d8 \[mac80211\]\
\[ 1024.950000\] \[<c078651c>\] ath\_rx\_tasklet+0xf4c/0x10a4 \[ath9k\]\
\[ 1024.950000\] \[<c078437c>\] ath9k\_tasklet+0x104/0x174 \[ath9k\]\
\[ 1024.950000\] \[&lt;800793b8&gt;\] tasklet\_action+0x78/0xc8\
\[ 1024.950000\] \[&lt;80078c08&gt;\] \_\_do\_softirq+0xb0/0x184\
\[ 1024.950000\] \[&lt;80078d8c&gt;\] do\_softirq+0x48/0x68\
\[ 1024.950000\] \[&lt;80078fa8&gt;\] irq\_exit+0x4c/0x7c\
\[ 1024.950000\] \[&lt;8006330c&gt;\] ret\_from\_irq+0x0/0x4\
\[ 1024.950000\]\
\[ 1024.950000\] --~~\[ end trace a47ff22dd20a96c2 \]--~~\
\[ 1024.950000\] Rebooting in 3 seconds..þþ

U-Boot 1.1.4 (May 27 2011 - 14:58:01)

------------------------------------------------------------------------

On Tue, Jan 8, 2013 at 9:45 PM, <cerowrt@lists.bufferbloat.net> wrote:\
>\
> Issue \#418 has been updated by David Taht.\
>\
>\
> While I acquired a serial adaptor for the 3800 I did not gain the
time\
> to look at this issue over the weekend.\
>\
> I'm buried this week and may not be able to get to this til the
weekend.\
> ----------------------------------------\
> Bug \#418: TFO crashes cerowrt 3.7.1-1\
> https://www.bufferbloat.net/issues/418
>\
> Author: David Taht\
> Status: New\
> Priority: Normal\
> Assignee: Dave Täht\
> Category: Networking\
> Target version:\
>\
>\
> I am not able to get through even a single TCP TFO connection. The
router restarts as soon as it sees the TFO connection.\
>\
> Looks like SYN+Data is crashing the box (see attached trace
captured on lo iface of cero). logread, dmesg did not show anything. I
don't know whether its kernel panic.\
>\
> This is strange as 3.6 was working for SYN+Data cases.\
>\
> However the difference from previous instance is the polipo server
with TFO running on cero box. Client may run on same cero or on my
laptop which in either case crashes the box.\
>\
> On 3.7, if I run the TFO client on cero box and TFO server on the
laptop, it still works but not the reverse.\
>\
> (see email thread at:
https://lists.bufferbloat.net/pipermail/cerowrt-devel/2013-January/000844.html
for more details)\
>\
>
{{< /issue_journal >}}
{{< issue_journal date="2013-01-13T03:17:28" author="Ketan Kulkarni" >}}
I do not know if this is the faulty line -

void reqsk\_fastopen\_remove(struct sock \*sk, struct request\_sock
\*req,\
bool reset)\
{\
struct sock \*lsk = tcp\_rsk(req)-&gt;listener;\
struct fastopen\_queue \*fastopenq =\
inet\_csk(lsk)-&gt;icsk\_accept\_queue.fastopenq;

>>>>> BUG\_ON(!spin\_is\_locked(&sk->sk\_lock.slock)
&& !sock\_owned\_by\_user(sk));

tcp\_sk(sk)-&gt;fastopen\_rsk = NULL;\
spin\_lock\_bh(&fastopenq-&gt;lock);\
fastopenq-&gt;qlen--;\
tcp\_rsk(req)-&gt;listener = NULL;

On Sun, Jan 13, 2013 at 4:44 PM, <cerowrt@lists.bufferbloat.net> wrote:\
>\
> Issue \#418 has been updated by Ketan Kulkarni.\
>\
>\
> I could get a chance to get the backtrace from serial port.\
> I didnt do the kgdb session yet.\
>\
> \[ 1024.530000\] Kernel bug detected\[\#1\]:\
> \[ 1024.530000\] Cpu 0\
> \[ 1024.530000\] \$ 0 : 00000000 00000000 00000001 00000014\
> \[ 1024.530000\] \$ 4 : 8600a9a0 85446cc0 00000000 377f8397\
> \[ 1024.530000\] \$ 8 : 00000000 00000000 00000000 204e7f80\
> \[ 1024.530000\] \$12 : 39808080 00000007 00000000 00000000\
> \[ 1024.530000\] \$16 : 85446cc0 854fb280 8600a500 00000000\
> \[ 1024.530000\] \$20 : 85446cc0 80340000 00000006 803aac70\
> \[ 1024.530000\] \$24 : 00000000 c0aa90d8\
> \[ 1024.530000\] \$28 : 854c2000 854c3ad8 8033c050 8024a36c\
> \[ 1024.530000\] Hi : 00000000\
> \[ 1024.530000\] Lo : 00000000\
> \[ 1024.530000\] epc : 801fc7f4 reqsk\_fastopen\_remove+0x30/0x17c\
> \[ 1024.530000\] Tainted: G O\
> \[ 1024.530000\] ra : 8024a36c
tcp\_rcv\_state\_process+0x7b4/0xc28\
> \[ 1024.530000\] Status: 1000fc03 KERNEL EXL IE\
> \[ 1024.530000\] Cause : 10800034\
> \[ 1024.530000\] PrId : 00019374 (MIPS 24Kc)\
> \[ 1024.530000\] Modules linked in: sch\_teql sch\_tbf sch\_sfq
sch\_red\
> sch\_qfq sch\_prio sch\_ns2\_codel sch\_nfq\_codel sch\_netem
sch\_htb\
> sch\_gred sch\_efq\_codel sch\_dsmark em\_text em\_nbyte em\_meta
em\_cmp\
> cls\_basic act\_police act\_ipt act\_connmark act\_skbedit
act\_mirred\
> em\_u32 cls\_u32 cls\_tcindex cls\_flow cls\_route cls\_fw
sch\_hfsc\
> sch\_fq\_codel sch\_codel sch\_ingress ath79\_wdt xt\_hashlimit
xt\_set(O)\
> ip\_set\_list\_set(O) ip\_set\_hash\_netport(O)
ip\_set\_hash\_netiface(O)\
> ip\_set\_hash\_net(O) ip\_set\_hash\_ipportnet(O)
ip\_set\_hash\_ipportip(O)\
> ip\_set\_hash\_ipport(O) ip\_set\_hash\_ip(O)
ip\_set\_bitmap\_port(O)\
> ip\_set\_bitmap\_ipmac(O) ip\_set\_bitmap\_ip(O) ip\_set(O)
ip6t\_REJECT\
> ip6t\_rt ip6t\_hbh ip6t\_mh ip6t\_ipv6header ip6t\_frag ip6t\_eui64
ip6t\_ah\
> ip6table\_raw ip6table\_mangle ip6table\_filter ip6\_tables\
> nf\_conntrack\_ipv6 nf\_defrag\_ipv6 nfnetlink nf\_nat\_irc
nf\_nat\_ftp\
> nf\_conntrack\_irc nf\_conntrack\_ftp xt\_policy xt\_esp ipt\_ah
xt\_HL xt\_hl\
> xt\_ecn ipt\_ECN xt\_CLASSIFY xt\_time xt\_tcpmss xt\_statistic
xt\_mark\
> xt\_length xt\_DSCP xt\_dscp xt\_string xt\_layer7 xt\_quota
xt\_pkttype\
> xt\_physdev xt\_owner ipt\_MASQUERADE iptable\_nat xt\_nat
nf\_nat\_ipv4\
> nf\_nat xt\_recent xt\_helper xt\_connmark xt\_connbytes pptp
pppoe\
> xt\_conntrack xt\_CT iptable\_raw xt\_state nf\_conntrack\_ipv4\
> nf\_defrag\_ipv4 nf\_conntrack pppox ipt\_REJECT xt\_TCPMSS
xt\_LOG\
> xt\_comment xt\_multiport xt\_mac xt\_limit iptable\_mangle
iptable\_filter\
> ip\_tables xt\_tcpudp x\_tables ip\_gre gre ifb sit xfrm4\_tunnel\
> xfrm4\_mode\_tunnel xfrm4\_mode\_transport xfrm4\_mode\_beet esp4
ah4\
> tunnel4 tun tcp\_ledbat(O) ppp\_async ppp\_generic slhc xfrm\_user\
> xfrm\_algo vfat fat autofs4 button\_hotplug(O) ath9k(O)
ath9k\_common(O)\
> ath9k\_hw(O) ath(O) nls\_utf8 nls\_iso8859\_2 nls\_iso8859\_15\
> nls\_iso8859\_13 nls\_iso8859\_1 nls\_cp437 mac80211(O) ts\_fsm
ts\_bm ts\_kmp\
> crc\_ccitt ipv6 input\_polldev cfg80211(O) compat(O) input\_core\
> sha1\_generic md5 hmac des\_generic deflate cbc authenc arc4
usb\_storage\
> ohci\_hcd ehci\_hcd sd\_mod ext4 jbd2 mbcache usbcore usb\_common
scsi\_mod\
> nls\_base crc16 zlib\_inflate zlib\_deflate ledtrig\_timer\
> ledtrig\_default\_on leds\_gpio gpio\_button\_hotplug(O)\
> \[ 1024.530000\] Process seq (pid: 4023, threadinfo=854c2000,\
> task=85461df8, tls=7735b440)\
> \[ 1024.530000\] Stack : 00000000 8600a9a0 87287d80 8607bb58
85446cc0\
> 80330000 8600a9a0 87287d80\
> 8607bb58 8024a36c c0aa9720 c2337090 86b39000 00000000 00000001
00000014\
> 00000001 02000004 862b6d24 c2337000 00000001 8547bf00 00000000
00000000\
> 854c3bcc 854c3bcc 87287d80 854c3bcc 87287d80 80325dd8 87287d80
8600a9a0\
> 8600a9a0 8607bb58 8607bb44 802516ec 87287d80 803261dc 80340000
80340000\
> ...\
> \[ 1024.530000\] Call Trace:\
> \[ 1024.530000\] \[&lt;801fc7f4>\]
reqsk\_fastopen\_remove+0x30/0x17c\
> \[ 1024.530000\] \[&lt;8024a36c>\]
tcp\_rcv\_state\_process+0x7b4/0xc28\
> \[ 1024.530000\] \[&lt;802516ec>\] tcp\_v4\_do\_rcv+0x21c/0x274\
> \[ 1024.530000\] \[&lt;80253c74>\] tcp\_v4\_rcv+0x5b4/0x974\
> \[ 1024.530000\] \[&lt;802320f0>\]
ip\_local\_deliver\_finish+0x168/0x29c\
> \[ 1024.530000\] \[&lt;80207100>\]
\_\_netif\_receive\_skb+0x63c/0x6c0\
> \[ 1024.530000\] \[<c060b2e8>\] ieee80211\_deliver\_skb+0x1b8/0x220
\[mac80211\]\
> \[ 1024.530000\] \[<c060cc70>\]\
> ieee80211\_rx\_handlers.part.12+0x1654/0x23e0 \[mac80211\]\
> \[ 1024.530000\] \[<c060e468>\]\
> ieee80211\_prepare\_and\_rx\_handle+0xa6c/0xaf0 \[mac80211\]\
> \[ 1024.530000\] \[<c060ecfc>\] ieee80211\_rx+0x810/0x8d8
\[mac80211\]\
> \[ 1024.530000\] \[<c078651c>\] ath\_rx\_tasklet+0xf4c/0x10a4
\[ath9k\]\
> \[ 1024.530000\] \[<c078437c>\] ath9k\_tasklet+0x104/0x174
\[ath9k\]\
> \[ 1024.530000\] \[&lt;800793b8>\] tasklet\_action+0x78/0xc8\
> \[ 1024.530000\] \[&lt;80078c08>\] \_\_do\_softirq+0xb0/0x184\
> \[ 1024.530000\] \[&lt;80078d8c>\] do\_softirq+0x48/0x68\
> \[ 1024.530000\] \[&lt;80078fa8>\] irq\_exit+0x4c/0x7c\
> \[ 1024.530000\] \[&lt;8006330c>\] ret\_from\_irq+0x0/0x4\
> \[ 1024.530000\]\
> \[ 1024.530000\]\
> Code: 8e510208 30d300ff 2c420001 &lt;00028036> 0c01e2a7
ac80048c\
> 8e220008 2442ffff ae220008\
> \[ 1024.940000\] --~~\[ end trace a47ff22dd20a96c1 \]--~~\
> \[ 1024.950000\] Kernel panic - not syncing: Fatal exception in
interrupt\
> \[ 1024.950000\] -----------~~\[ cut here \]-----------~~\
> \[ 1024.950000\] WARNING: at lib/vsprintf.c:1376
vsnprintf+0x6c/0x39c()\
> \[ 1024.950000\] Modules linked in: sch\_teql sch\_tbf sch\_sfq
sch\_red\
> sch\_qfq sch\_prio sch\_ns2\_codel sch\_nfq\_codel sch\_netem
sch\_htb\
> sch\_gred sch\_efq\_codel sch\_dsmark em\_text em\_nbyte em\_meta
em\_cmp\
> cls\_basic act\_police act\_ipt act\_connmark act\_skbedit
act\_mirred\
> em\_u32 cls\_u32 cls\_tcindex cls\_flow cls\_route cls\_fw
sch\_hfsc\
> sch\_fq\_codel sch\_codel sch\_ingress ath79\_wdt xt\_hashlimit
xt\_set(O)\
> ip\_set\_list\_set(O) ip\_set\_hash\_netport(O)
ip\_set\_hash\_netiface(O)\
> ip\_set\_hash\_net(O) ip\_set\_hash\_ipportnet(O)
ip\_set\_hash\_ipportip(O)\
> ip\_set\_hash\_ipport(O) ip\_set\_hash\_ip(O)
ip\_set\_bitmap\_port(O)\
> ip\_set\_bitmap\_ipmac(O) ip\_set\_bitmap\_ip(O) ip\_set(O)
ip6t\_REJECT\
> ip6t\_rt ip6t\_hbh ip6t\_mh ip6t\_ipv6header ip6t\_frag ip6t\_eui64
ip6t\_ah\
> ip6table\_raw ip6table\_mangle ip6table\_filter ip6\_tables\
> nf\_conntrack\_ipv6 nf\_defrag\_ipv6 nfnetlink nf\_nat\_irc
nf\_nat\_ftp\
> nf\_conntrack\_irc nf\_conntrack\_ftp xt\_policy xt\_esp ipt\_ah
xt\_HL xt\_hl\
> xt\_ecn ipt\_ECN xt\_CLASSIFY xt\_time xt\_tcpmss xt\_statistic
xt\_mark\
> xt\_length xt\_DSCP xt\_dscp xt\_string xt\_layer7 xt\_quota
xt\_pkttype\
> xt\_physdev xt\_owner ipt\_MASQUERADE iptable\_nat xt\_nat
nf\_nat\_ipv4\
> nf\_nat xt\_recent xt\_helper xt\_connmark xt\_connbytes pptp
pppoe\
> xt\_conntrack xt\_CT iptable\_raw xt\_state nf\_conntrack\_ipv4\
> nf\_defrag\_ipv4 nf\_conntrack pppox ipt\_REJECT xt\_TCPMSS
xt\_LOG\
> xt\_comment xt\_multiport xt\_mac xt\_limit iptable\_mangle
iptable\_filter\
> ip\_tables xt\_tcpudp x\_tables ip\_gre gre ifb sit xfrm4\_tunnel\
> xfrm4\_mode\_tunnel xfrm4\_mode\_transport xfrm4\_mode\_beet esp4
ah4\
> tunnel4 tun tcp\_ledbat(O) ppp\_async ppp\_generic slhc xfrm\_user\
> xfrm\_algo vfat fat autofs4 button\_hotplug(O) ath9k(O)
ath9k\_common(O)\
> ath9k\_hw(O) ath(O) nls\_utf8 nls\_iso8859\_2 nls\_iso8859\_15\
> nls\_iso8859\_13 nls\_iso8859\_1 nls\_cp437 mac80211(O) ts\_fsm
ts\_bm ts\_kmp\
> crc\_ccitt ipv6 input\_polldev cfg80211(O) compat(O) input\_core\
> sha1\_generic md5 hmac des\_generic deflate cbc authenc arc4
usb\_storage\
> ohci\_hcd ehci\_hcd sd\_mod ext4 jbd2 mbcache usbcore usb\_common
scsi\_mod\
> nls\_base crc16 zlib\_inflate zlib\_deflate ledtrig\_timer\
> ledtrig\_default\_on leds\_gpio gpio\_button\_hotplug(O)\
> \[ 1024.950000\] Call Trace:\
> \[ 1024.950000\] \[&lt;802a25e8>\] dump\_stack+0x8/0x34\
> \[ 1024.950000\] \[&lt;80071f84>\]
warn\_slowpath\_common+0x78/0xa4\
> \[ 1024.950000\] \[&lt;80071fc8>\]
warn\_slowpath\_null+0x18/0x24\
> \[ 1024.950000\] \[&lt;80183d5c>\] vsnprintf+0x6c/0x39c\
> \[ 1024.950000\] \[&lt;800bc99c>\] crashlog\_printf+0x4c/0x68\
> \[ 1024.950000\] \[&lt;800bca0c>\]
crashlog\_do\_dump+0x54/0x138\
> \[ 1024.950000\] \[&lt;800752bc>\] kmsg\_dump+0xe0/0x11c\
> \[ 1024.950000\] \[&lt;802a26b4>\] panic+0x8c/0x1b4\
> \[ 1024.950000\] \[&lt;80067b68>\] die+0x104/0x10c\
> \[ 1024.950000\] \[&lt;80067cd0>\] do\_trap\_or\_bp+0x118/0x18c\
> \[ 1024.950000\] \[&lt;80063300>\] ret\_from\_exception+0x0/0xc\
> \[ 1024.950000\] \[&lt;801fc7f4>\]
reqsk\_fastopen\_remove+0x30/0x17c\
> \[ 1024.950000\] \[&lt;8024a36c>\]
tcp\_rcv\_state\_process+0x7b4/0xc28\
> \[ 1024.950000\] \[&lt;802516ec>\] tcp\_v4\_do\_rcv+0x21c/0x274\
> \[ 1024.950000\] \[&lt;80253c74>\] tcp\_v4\_rcv+0x5b4/0x974\
> \[ 1024.950000\] \[&lt;802320f0>\]
ip\_local\_deliver\_finish+0x168/0x29c\
> \[ 1024.950000\] \[&lt;80207100>\]
\_\_netif\_receive\_skb+0x63c/0x6c0\
> \[ 1024.950000\] \[<c060b2e8>\] ieee80211\_deliver\_skb+0x1b8/0x220
\[mac80211\]\
> \[ 1024.950000\] \[<c060cc70>\]\
> ieee80211\_rx\_handlers.part.12+0x1654/0x23e0 \[mac80211\]\
> \[ 1024.950000\] \[<c060e468>\]\
> ieee80211\_prepare\_and\_rx\_handle+0xa6c/0xaf0 \[mac80211\]\
> \[ 1024.950000\] \[<c060ecfc>\] ieee80211\_rx+0x810/0x8d8
\[mac80211\]\
> \[ 1024.950000\] \[<c078651c>\] ath\_rx\_tasklet+0xf4c/0x10a4
\[ath9k\]\
> \[ 1024.950000\] \[<c078437c>\] ath9k\_tasklet+0x104/0x174
\[ath9k\]\
> \[ 1024.950000\] \[&lt;800793b8>\] tasklet\_action+0x78/0xc8\
> \[ 1024.950000\] \[&lt;80078c08>\] \_\_do\_softirq+0xb0/0x184\
> \[ 1024.950000\] \[&lt;80078d8c>\] do\_softirq+0x48/0x68\
> \[ 1024.950000\] \[&lt;80078fa8>\] irq\_exit+0x4c/0x7c\
> \[ 1024.950000\] \[&lt;8006330c>\] ret\_from\_irq+0x0/0x4\
> \[ 1024.950000\]\
> \[ 1024.950000\] --~~\[ end trace a47ff22dd20a96c2 \]--~~\
> \[ 1024.950000\] Rebooting in 3 seconds..þþ\
>\
> U-Boot 1.1.4 (May 27 2011 - 14:58:01)\
>\
> --------------\
>\
> On Tue, Jan 8, 2013 at 9:45 PM, <cerowrt@lists.bufferbloat.net>
wrote:\
>>\
>> Issue \#418 has been updated by David Taht.\
>>\
>>\
>> While I acquired a serial adaptor for the 3800 I did not gain
the time\
>> to look at this issue over the weekend.\
>>\
>> I'm buried this week and may not be able to get to this til the
weekend.\
>> ----------------------------------------\
>> Bug \#418: TFO crashes cerowrt 3.7.1-1\
>> https://www.bufferbloat.net/issues/418
>>\
>> Author: David Taht\
>> Status: New\
>> Priority: Normal\
>> Assignee: Dave Täht\
>> Category: Networking\
>> Target version:\
>>\
>>\
>> I am not able to get through even a single TCP TFO connection.
The router restarts as soon as it sees the TFO connection.\
>>\
>> Looks like SYN+Data is crashing the box (see attached trace
captured on lo iface of cero). logread, dmesg did not show anything. I
don't know whether its kernel panic.\
>>\
>> This is strange as 3.6 was working for SYN+Data cases.\
>>\
>> However the difference from previous instance is the polipo
server with TFO running on cero box. Client may run on same cero or on
my laptop which in either case crashes the box.\
>>\
>> On 3.7, if I run the TFO client on cero box and TFO server on
the laptop, it still works but not the reverse.\
>>\
>> (see email thread at:
https://lists.bufferbloat.net/pipermail/cerowrt-devel/2013-January/000844.html
for more details)\
>>\
>>\
> ----------------------------------------\
> Bug \#418: TFO crashes cerowrt 3.7.1-1\
> https://www.bufferbloat.net/issues/418
>\
> Author: David Taht\
> Status: New\
> Priority: Normal\
> Assignee: Dave Täht\
> Category: Networking\
> Target version:\
>\
>\
> I am not able to get through even a single TCP TFO connection. The
router restarts as soon as it sees the TFO connection.\
>\
> Looks like SYN+Data is crashing the box (see attached trace
captured on lo iface of cero). logread, dmesg did not show anything. I
don't know whether its kernel panic.\
>\
> This is strange as 3.6 was working for SYN+Data cases.\
>\
> However the difference from previous instance is the polipo server
with TFO running on cero box. Client may run on same cero or on my
laptop which in either case crashes the box.\
>\
> On 3.7, if I run the TFO client on cero box and TFO server on the
laptop, it still works but not the reverse.\
>\
> (see email thread at:
https://lists.bufferbloat.net/pipermail/cerowrt-devel/2013-January/000844.html
for more details)\
>\
>
{{< /issue_journal >}}
{{< issue_journal date="2013-01-14T01:24:53" author="Ketan Kulkarni" >}}
Eric suggested a patch to fix the issue -\
More details of the analysis and fix here -

https://lists.bufferbloat.net/pipermail/cerowrt-devel/2013-January/000897.html
{{< /issue_journal >}}
{{< issue_journal date="2013-01-14T01:26:56" author="Ketan Kulkarni" >}}

{{< /issue_journal >}}
{{< issue_journal date="2014-05-14T11:35:21" author="Dave Täht" >}}

{{< /issue_journal >}}

